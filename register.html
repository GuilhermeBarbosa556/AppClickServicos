<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Serviços - Cadastro</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Navegação Header -->
    <div class="nav-header">
        <a href="index.html" class="nav-logo">
            <span class="material-icons">handyman</span>
            Click Serviços
        </a>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Início</a>
            <a href="login.html" class="nav-button">Login</a>
        </div>
    </div>

    <!-- Container de Cadastro -->
    <div class="register-container">
        <div class="register-card">
            <div class="register-header">
                <h1 class="register-title">Criar Conta</h1>
                <p class="register-subtitle">Junte-se ao Click Serviços e encontre os melhores prestadores</p>
            </div>

            <div class="progress-bar">
                <div class="progress-step">
                    <div class="step-circle active" id="step-1">1</div>
                    <div class="step-label">Informações Básicas</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step-2">2</div>
                    <div class="step-label">Tipo de Conta</div>
                </div>
                <div class="progress-step">
                    <div class="step-circle" id="step-3">3</div>
                    <div class="step-label">Confirmação</div>
                </div>
            </div>

            <form id="register-form">
                <!-- Passo 1: Informações Básicas -->
                <div class="step-content active" id="step1-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name" class="form-label">Nome Completo *</label>
                            <input type="text" id="name" class="form-input" placeholder="Seu nome completo" required>
                            <div id="name-error" class="error-message"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email" class="form-label">E-mail *</label>
                            <input type="email" id="email" class="form-input" placeholder="seu@email.com" required>
                            <div id="email-error" class="error-message"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone" class="form-label">Telefone *</label>
                            <input type="tel" id="phone" class="form-input" placeholder="(11) 99999-9999" required>
                            <div id="phone-error" class="error-message"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="password" class="form-label">Senha *</label>
                            <div class="password-input">
                                <input type="password" id="password" class="form-input" placeholder="Digite sua senha" required>
                                <button type="button" class="toggle-password" id="toggle-password1">
                                    <span class="material-icons" id="toggle-icon1">visibility_off</span>
                                </button>
                            </div>
                            <div id="password-error" class="error-message"></div>
                        </div>
                        <div class="form-group">
                            <label for="confirm-password" class="form-label">Confirmar Senha *</label>
                            <div class="password-input">
                                <input type="password" id="confirm-password" class="form-input" placeholder="Confirme sua senha" required>
                                <button type="button" class="toggle-password" id="toggle-password2">
                                    <span class="material-icons" id="toggle-icon2">visibility_off</span>
                                </button>
                            </div>
                            <div id="confirm-password-error" class="error-message"></div>
                        </div>
                    </div>

                    <div class="buttons-container">
                        <button type="button" class="back-button" disabled>Voltar</button>
                        <button type="button" class="next-button" id="next-to-step2">Próximo</button>
                    </div>
                </div>

                <!-- Passo 2: Tipo de Conta -->
                <div class="step-content" id="step2-content">
                    <div class="user-type">
                        <div class="user-type-option" data-type="client">
                            <span class="material-icons user-type-icon">person</span>
                            <div style="font-weight: 500;">Cliente</div>
                            <div style="font-size: 12px; color: var(--text-light); margin-top: 4px;">
                                Contratar serviços
                            </div>
                        </div>
                        <div class="user-type-option" data-type="provider">
                            <span class="material-icons user-type-icon">business_center</span>
                            <div style="font-weight: 500;">Prestador</div>
                            <div style="font-size: 12px; color: var(--text-light); margin-top: 4px;">
                                Oferecer serviços
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="location" class="form-label">Cidade *</label>
                            <input type="text" id="location" class="form-input" placeholder="Sua cidade" required>
                            <div id="location-error" class="error-message"></div>
                        </div>
                    </div>

                    <div id="provider-fields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="category" class="form-label">Categoria do Serviço *</label>
                                <select id="category" class="form-select" required>
                                    <option value="">Selecione uma categoria</option>
                                    <option value="Elétrica">Elétrica</option>
                                    <option value="Limpeza">Limpeza</option>
                                    <option value="Encanamento">Encanamento</option>
                                    <option value="Construção">Construção</option>
                                    <option value="Aulas">Aulas</option>
                                    <option value="Pintura">Pintura</option>
                                    <option value="Jardim">Jardim</option>
                                    <option value="Móveis">Móveis</option>
                                    <option value="Tecnologia">Tecnologia</option>
                                    <option value="Outro">Outro</option>
                                </select>
                                <div id="category-error" class="error-message"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="description" class="form-label">Descrição do Serviço *</label>
                            <textarea id="description" class="form-input" rows="3" placeholder="Descreva seus serviços..." required></textarea>
                            <div id="description-error" class="error-message"></div>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="terms" required>
                        <label for="terms">
                            Concordo com os <a href="#" id="terms-link">Termos de Uso</a> e <a href="#" id="privacy-link">Política de Privacidade</a> *
                        </label>
                    </div>
                    <div id="terms-error" class="error-message"></div>

                    <div class="buttons-container">
                        <button type="button" class="back-button" id="back-to-step1">Voltar</button>
                        <button type="button" class="next-button" id="next-to-step3">Próximo</button>
                    </div>
                </div>

                <!-- Passo 3: Confirmação -->
                <div class="step-content" id="step3-content">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <span class="material-icons" style="font-size: 64px; color: var(--primary-color); margin-bottom: 16px;">
                            check_circle
                        </span>
                        <h3 style="margin-bottom: 8px;">Confirmação</h3>
                        <p style="color: var(--text-light);">Revise suas informações antes de criar a conta</p>
                    </div>

                    <div class="info-card" style="margin-bottom: 16px;">
                        <div class="info-card-content">
                            <div class="info-row">
                                <span class="material-icons info-icon">person</span>
                                <div class="info-content">
                                    <span class="info-title">Nome</span>
                                    <span class="info-value" id="review-name">-</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <span class="material-icons info-icon">email</span>
                                <div class="info-content">
                                    <span class="info-title">E-mail</span>
                                    <span class="info-value" id="review-email">-</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <span class="material-icons info-icon">phone</span>
                                <div class="info-content">
                                    <span class="info-title">Telefone</span>
                                    <span class="info-value" id="review-phone">-</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <span class="material-icons info-icon">location_on</span>
                                <div class="info-content">
                                    <span class="info-title">Cidade</span>
                                    <span class="info-value" id="review-location">-</span>
                                </div>
                            </div>
                            <div class="info-row">
                                <span class="material-icons info-icon">business_center</span>
                                <div class="info-content">
                                    <span class="info-title">Tipo de Conta</span>
                                    <span class="info-value" id="review-type">-</span>
                                </div>
                            </div>
                            <div id="review-category-row" class="info-row" style="display: none;">
                                <span class="material-icons info-icon">category</span>
                                <div class="info-content">
                                    <span class="info-title">Categoria</span>
                                    <span class="info-value" id="review-category">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="buttons-container">
                        <button type="button" class="back-button" id="back-to-step2">Voltar</button>
                        <button type="submit" class="register-button" id="complete-register">
                            <span id="register-text">Criar Conta</span>
                            <span id="register-loading" class="hidden">
                                <span class="material-icons loading">refresh</span> Criando conta...
                            </span>
                        </button>
                    </div>
                </div>
            </form>

            <div class="login-link">
                Já tem uma conta? <a href="login.html">Faça login</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Click Serviços</h3>
                <p>Conectando você aos melhores prestadores de serviço da região.</p>
            </div>
            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <ul class="footer-links">
                    <li><a href="index.html">Início</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="register.html">Cadastro</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contato</h3>
                <ul class="footer-links">
                    <li><a href="mailto:suporte@clickservicos.com">suporte@clickservicos.com</a></li>
                    <li><a href="tel:+5511999999999">(11) 99999-9999</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Click Serviços. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Modal de Termos -->
    <div id="terms-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Termos de Uso</h2>
                <button class="modal-close" id="close-terms-modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 16px;"><strong>Última atualização: Janeiro 2024</strong></p>
                <div style="max-height: 400px; overflow-y: auto; padding-right: 8px;">
                    <h4 style="margin-bottom: 8px;">1. Aceitação dos Termos</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Ao acessar e usar o Click Serviços, você concorda com estes Termos de Uso e com nossa Política de Privacidade.</p>
                    
                    <h4 style="margin-bottom: 8px;">2. Uso da Plataforma</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">A plataforma permite a conexão entre clientes e prestadores de serviços. Não somos empregadores dos prestadores.</p>
                    
                    <h4 style="margin-bottom: 8px;">3. Responsabilidades</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Você é responsável por todas as atividades realizadas em sua conta e pelas informações fornecidas.</p>
                    
                    <h4 style="margin-bottom: 8px;">4. Pagamentos</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Os pagamentos são processados por terceiros. Não nos responsabilizamos por problemas em transações externas.</p>
                    
                    <h4 style="margin-bottom: 8px;">5. Modificações</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Podemos modificar estes termos a qualquer momento. Alterações significativas serão notificadas.</p>
                    
                    <h4 style="margin-bottom: 8px;">6. Limitação de Responsabilidade</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Não nos responsabilizamos por danos diretos ou indiretos decorrentes do uso da plataforma.</p>
                    
                    <h4 style="margin-bottom: 8px;">7. Lei Aplicável</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Estes termos são regidos pelas leis brasileiras.</p>
                </div>
            </div>
            <div class="modal-content" style="display: flex; justify-content: flex-end; padding-top: 0;">
                <button class="contact-button" style="background-color: var(--primary-color);" id="close-terms-button">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Privacidade -->
    <div id="privacy-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Política de Privacidade</h2>
                <button class="modal-close" id="close-privacy-modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 16px;"><strong>Última atualização: Janeiro 2024</strong></p>
                <div style="max-height: 400px; overflow-y: auto; padding-right: 8px;">
                    <h4 style="margin-bottom: 8px;">1. Coleta de Dados</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Coletamos informações que você fornece diretamente, como nome, e-mail, telefone, localização, categoria de serviço e descrição.</p>
                    
                    <h4 style="margin-bottom: 8px;">2. Uso das Informações</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Utilizamos seus dados para fornecer e melhorar nossos serviços, conectar clientes e prestadores, comunicar com você e personalizar sua experiência.</p>
                    
                    <h4 style="margin-bottom: 8px;">3. Compartilhamento</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Não vendemos seus dados. Compartilhamos apenas informações necessárias para a prestação de serviços (ex: nome e contato do prestador com o cliente).</p>
                    
                    <h4 style="margin-bottom: 8px;">4. Segurança</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Implementamos medidas de segurança técnicas e organizacionais para proteger suas informações contra acesso não autorizado.</p>
                    
                    <h4 style="margin-bottom: 8px;">5. Seus Direitos</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Você pode acessar, corrigir ou excluir seus dados a qualquer momento através das configurações da conta ou entrando em contato conosco.</p>
                    
                    <h4 style="margin-bottom: 8px;">6. Cookies</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Utilizamos cookies para melhorar sua experiência de navegação e analisar o uso do site.</p>
                    
                    <h4 style="margin-bottom: 8px;">7. Alterações</h4>
                    <p style="margin-bottom: 16px; font-size: 14px;">Podemos atualizar esta política periodicamente. Notificaremos sobre mudanças significativas.</p>
                </div>
            </div>
            <div class="modal-content" style="display: flex; justify-content: flex-end; padding-top: 0;">
                <button class="contact-button" style="background-color: var(--primary-color);" id="close-privacy-button">Fechar</button>
            </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="config.js"></script>
    <script src="navigation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos
            const registerForm = document.getElementById('register-form');
            const stepContents = document.querySelectorAll('.step-content');
            const stepCircles = document.querySelectorAll('.step-circle');
            const nextToStep2 = document.getElementById('next-to-step2');
            const nextToStep3 = document.getElementById('next-to-step3');
            const backToStep1 = document.getElementById('back-to-step1');
            const backToStep2 = document.getElementById('back-to-step2');
            const completeRegister = document.getElementById('complete-register');
            const userTypeOptions = document.querySelectorAll('.user-type-option');
            const providerFields = document.getElementById('provider-fields');
            const termsLink = document.getElementById('terms-link');
            const privacyLink = document.getElementById('privacy-link');
            const termsModal = document.getElementById('terms-modal');
            const privacyModal = document.getElementById('privacy-modal');
            const closeTermsModal = document.getElementById('close-terms-modal');
            const closeTermsButton = document.getElementById('close-terms-button');
            const closePrivacyModal = document.getElementById('close-privacy-modal');
            const closePrivacyButton = document.getElementById('close-privacy-button');
            const registerText = document.getElementById('register-text');
            const registerLoading = document.getElementById('register-loading');
            const reviewCategoryRow = document.getElementById('review-category-row');

            let currentStep = 1;
            let userType = 'client';

            // Funções para mostrar/esconder loading
            function showLoading(button) {
                const textElement = button.querySelector('#register-text');
                const loadingElement = button.querySelector('#register-loading');
                if (textElement && loadingElement) {
                    textElement.classList.add('hidden');
                    loadingElement.classList.remove('hidden');
                }
                button.disabled = true;
            }

            function hideLoading(button) {
                const textElement = button.querySelector('#register-text');
                const loadingElement = button.querySelector('#register-loading');
                if (textElement && loadingElement) {
                    textElement.classList.remove('hidden');
                    loadingElement.classList.add('hidden');
                }
                button.disabled = false;
            }

            // Alternar visibilidade da senha
            document.querySelectorAll('.toggle-password').forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    const inputId = index === 0 ? 'password' : 'confirm-password';
                    const iconId = index === 0 ? 'toggle-icon1' : 'toggle-icon2';
                    const input = document.getElementById(inputId);
                    const icon = document.getElementById(iconId);
                    
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    icon.textContent = type === 'password' ? 'visibility_off' : 'visibility';
                });
            });

            // Funções de validação
            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            function validatePhone(phone) {
                const re = /^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$/;
                return re.test(phone);
            }

            function validatePassword(password) {
                return password.length >= 6;
            }

            // Tipo de usuário
            userTypeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    userTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    userType = this.getAttribute('data-type');
                    
                    if (userType === 'provider') {
                        providerFields.style.display = 'block';
                        document.getElementById('category').required = true;
                        document.getElementById('description').required = true;
                    } else {
                        providerFields.style.display = 'none';
                        document.getElementById('category').required = false;
                        document.getElementById('description').required = false;
                    }
                });
            });

            // Navegação entre passos
            function goToStep(step) {
                stepContents.forEach(content => content.classList.remove('active'));
                stepCircles.forEach(circle => circle.classList.remove('active'));
                
                document.getElementById(`step${step}-content`).classList.add('active');
                
                for (let i = 1; i <= step; i++) {
                    document.getElementById(`step-${i}`).classList.add('active');
                }
                
                currentStep = step;
            }

            // Limpar todos os erros
            function clearAllErrors() {
                document.querySelectorAll('.error-message').forEach(error => {
                    error.textContent = '';
                    error.classList.remove('show');
                });
            }

            // Validação do passo 1
            function validateStep1() {
                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                let isValid = true;
                
                // Validar nome
                if (!name) {
                    document.getElementById('name-error').textContent = 'Por favor, insira seu nome completo';
                    document.getElementById('name-error').classList.add('show');
                    isValid = false;
                } else if (name.length < 3) {
                    document.getElementById('name-error').textContent = 'Nome deve ter pelo menos 3 caracteres';
                    document.getElementById('name-error').classList.add('show');
                    isValid = false;
                }
                
                // Validar e-mail
                if (!validateEmail(email)) {
                    document.getElementById('email-error').textContent = 'Por favor, insira um e-mail válido';
                    document.getElementById('email-error').classList.add('show');
                    isValid = false;
                }
                
                // Validar telefone
                if (!validatePhone(phone)) {
                    document.getElementById('phone-error').textContent = 'Por favor, insira um telefone válido';
                    document.getElementById('phone-error').classList.add('show');
                    isValid = false;
                }
                
                // Validar senha
                if (!validatePassword(password)) {
                    document.getElementById('password-error').textContent = 'A senha deve ter pelo menos 6 caracteres';
                    document.getElementById('password-error').classList.add('show');
                    isValid = false;
                }
                
                // Validar confirmação de senha
                if (password !== confirmPassword) {
                    document.getElementById('confirm-password-error').textContent = 'As senhas não coincidem';
                    document.getElementById('confirm-password-error').classList.add('show');
                    isValid = false;
                }
                
                return isValid;
            }

            // Validação do passo 2
            function validateStep2() {
                const location = document.getElementById('location').value.trim();
                const terms = document.getElementById('terms').checked;
                const category = document.getElementById('category').value;
                const description = document.getElementById('description').value;
                
                let isValid = true;
                
                // Validar localização
                if (!location) {
                    document.getElementById('location-error').textContent = 'Por favor, insira sua cidade';
                    document.getElementById('location-error').classList.add('show');
                    isValid = false;
                }
                
                // Validar termos
                if (!terms) {
                    document.getElementById('terms-error').textContent = 'Você precisa aceitar os termos de uso';
                    document.getElementById('terms-error').classList.add('show');
                    isValid = false;
                }
                
                // Validar campos específicos de prestador
                if (userType === 'provider') {
                    if (!category) {
                        document.getElementById('category-error').textContent = 'Por favor, selecione uma categoria';
                        document.getElementById('category-error').classList.add('show');
                        isValid = false;
                    }
                    
                    if (!description.trim()) {
                        document.getElementById('description-error').textContent = 'Por favor, descreva seus serviços';
                        document.getElementById('description-error').classList.add('show');
                        isValid = false;
                    }
                }
                
                return isValid;
            }

            // Atualizar revisão
            function updateReview() {
                document.getElementById('review-name').textContent = document.getElementById('name').value.trim();
                document.getElementById('review-email').textContent = document.getElementById('email').value.trim();
                document.getElementById('review-phone').textContent = document.getElementById('phone').value.trim();
                document.getElementById('review-location').textContent = document.getElementById('location').value.trim();
                document.getElementById('review-type').textContent = userType === 'client' ? 'Cliente' : 'Prestador de Serviços';
                
                if (userType === 'provider') {
                    reviewCategoryRow.style.display = 'flex';
                    document.getElementById('review-category').textContent = document.getElementById('category').value;
                } else {
                    reviewCategoryRow.style.display = 'none';
                }
            }

            // Event listeners
            nextToStep2.addEventListener('click', function() {
                clearAllErrors();
                if (validateStep1()) {
                    goToStep(2);
                }
            });

            nextToStep3.addEventListener('click', function() {
                clearAllErrors();
                if (validateStep2()) {
                    updateReview();
                    goToStep(3);
                }
            });

            backToStep1.addEventListener('click', function() {
                clearAllErrors();
                goToStep(1);
            });

            backToStep2.addEventListener('click', function() {
                clearAllErrors();
                goToStep(2);
            });

            // Validação em tempo real
            document.getElementById('name').addEventListener('input', function() {
                if (this.value.trim().length >= 3) {
                    document.getElementById('name-error').classList.remove('show');
                }
            });

            document.getElementById('email').addEventListener('input', function() {
                if (validateEmail(this.value.trim())) {
                    document.getElementById('email-error').classList.remove('show');
                }
            });

            document.getElementById('phone').addEventListener('input', function() {
                if (validatePhone(this.value.trim())) {
                    document.getElementById('phone-error').classList.remove('show');
                }
            });

            document.getElementById('password').addEventListener('input', function() {
                if (validatePassword(this.value)) {
                    document.getElementById('password-error').classList.remove('show');
                }
            });

            document.getElementById('confirm-password').addEventListener('input', function() {
                const password = document.getElementById('password').value;
                if (this.value === password) {
                    document.getElementById('confirm-password-error').classList.remove('show');
                }
            });

            document.getElementById('location').addEventListener('input', function() {
                if (this.value.trim()) {
                    document.getElementById('location-error').classList.remove('show');
                }
            });

            document.getElementById('terms').addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('terms-error').classList.remove('show');
                }
            });

            // Modal de termos
            termsLink.addEventListener('click', function(e) {
                e.preventDefault();
                termsModal.classList.remove('hidden');
            });

            privacyLink.addEventListener('click', function(e) {
                e.preventDefault();
                privacyModal.classList.remove('hidden');
            });

            closeTermsModal.addEventListener('click', function() {
                termsModal.classList.add('hidden');
            });

            closeTermsButton.addEventListener('click', function() {
                termsModal.classList.add('hidden');
            });

            closePrivacyModal.addEventListener('click', function() {
                privacyModal.classList.add('hidden');
            });

            closePrivacyButton.addEventListener('click', function() {
                privacyModal.classList.add('hidden');
            });

            // Fechar modais clicando fora
            termsModal.addEventListener('click', function(e) {
                if (e.target === termsModal) {
                    termsModal.classList.add('hidden');
                }
            });

            privacyModal.addEventListener('click', function(e) {
                if (e.target === privacyModal) {
                    privacyModal.classList.add('hidden');
                }
            });

            // Preencher máscara de telefone
            document.getElementById('phone').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 11) {
                    value = value.substring(0, 11);
                }
                
                if (value.length > 10) {
                    value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
                } else if (value.length > 6) {
                    value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
                } else if (value.length > 2) {
                    value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
                } else if (value.length > 0) {
                    value = value.replace(/^(\d*)$/, '($1');
                }
                
                e.target.value = value;
            });

            // Submissão final do formulário com Firebase
            registerForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validar todos os passos
                clearAllErrors();
                if (!validateStep1() || !validateStep2()) {
                    showToast('Por favor, corrija os erros no formulário.', 'error');
                    goToStep(1);
                    return;
                }
                
                // Coletar dados
                const userData = {
                    nome: document.getElementById('name').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    telefone: document.getElementById('phone').value.trim(),
                    localizacao: document.getElementById('location').value.trim(),
                    tipo: userType,
                    dataCadastro: new Date().toISOString(),
                    servicosContratados: 0,
                    avaliacoes: []
                };
                
                // Adicionar dados específicos de prestador
                if (userType === 'provider') {
                    userData.categoria = document.getElementById('category').value;
                    userData.descricao = document.getElementById('description').value;
                }
                
                const password = document.getElementById('password').value;
                
                // Verificar se Firebase está disponível
                if (!isFirebaseAvailable()) {
                    showToast('Sistema de cadastro não disponível no momento. Tente novamente mais tarde.', 'error');
                    return;
                }
                
                try {
                    // Mostrar loading
                    showLoading(completeRegister);
                    
                    // Verificar se Firebase Auth está disponível
                    if (!window.firebaseAuth || !window.firebaseAuth.createUserWithEmailAndPassword) {
                        throw new Error('Firebase Auth não inicializado');
                    }
                    
                    // 1. Criar usuário no Firebase Authentication
                    const userCredential = await window.firebaseAuth.createUserWithEmailAndPassword(userData.email, password);
                    const user = userCredential.user;
                    
                    // 2. Atualizar display name no Firebase Auth
                    await user.updateProfile({
                        displayName: userData.nome
                    });
                    
                    // 3. Salvar dados adicionais no Firestore (coleção users)
                    if (window.firebaseDb && window.firebaseDb.collection) {
                        await window.firebaseDb.collection('users').doc(user.uid).set({
                            ...userData,
                            uid: user.uid,
                            dataAtualizacao: new Date().toISOString()
                        });
                        
                        // 4. Se for prestador, criar também na coleção de prestadores
                        if (userData.tipo === 'provider') {
                            await window.firebaseDb.collection('prestadores').doc(user.uid).set({
                                nome: userData.nome,
                                email: userData.email,
                                telefone: userData.telefone,
                                localizacao: userData.localizacao,
                                categoria: userData.categoria,
                                descricao: userData.descricao,
                                avaliacaoMedia: 0,
                                totalAvaliacoes: 0,
                                totalServicos: 0,
                                ativo: true,
                                dataCadastro: new Date().toISOString(),
                                dataAtualizacao: new Date().toISOString()
                            });
                        }
                    }
                    
                    // 5. Salvar dados básicos no localStorage
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('userName', userData.nome);
                    localStorage.setItem('userEmail', userData.email);
                    localStorage.setItem('userUid', user.uid);
                    localStorage.setItem('userPhone', userData.telefone);
                    localStorage.setItem('userLocation', userData.localizacao);
                    localStorage.setItem('userType', userData.tipo);
                    
                    if (userData.tipo === 'provider') {
                        localStorage.setItem('userCategory', userData.categoria);
                        localStorage.setItem('userDescription', userData.descricao);
                    }
                    
                    // 6. Atualizar navigation.js se existir
                    if (typeof navigation !== 'undefined') {
                        navigation.updateUserData({
                            ...userData,
                            uid: user.uid
                        });
                    }
                    
                    // 7. Sucesso
                    showToast('Conta criada com sucesso! Bem-vindo ao Click Serviços!', 'success');
                    
                    // Redirecionar após breve delay
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    
                } catch (error) {
                    // Restaurar botão
                    hideLoading(completeRegister);
                    
                    // Tratar erros
                    let errorMessage = 'Erro ao criar conta. Tente novamente.';
                    let errorField = 'general';
                    
                    if (error.code) {
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage = 'Este e-mail já está em uso. Tente fazer login ou usar outro e-mail.';
                                errorField = 'email';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'E-mail inválido. Verifique o formato.';
                                errorField = 'email';
                                break;
                            case 'auth/weak-password':
                                errorMessage = 'Senha muito fraca. Use pelo menos 6 caracteres.';
                                errorField = 'password';
                                break;
                            case 'auth/operation-not-allowed':
                                errorMessage = 'Cadastro por e-mail/senha não está habilitado. Contate o suporte.';
                                break;
                            case 'auth/network-request-failed':
                                errorMessage = 'Erro de conexão. Verifique sua internet e tente novamente.';
                                break;
                            case 'firestore/permission-denied':
                                errorMessage = 'Permissão negada. Contate o suporte técnico.';
                                break;
                            default:
                                errorMessage = error.message || 'Erro desconhecido. Tente novamente.';
                        }
                    } else {
                        errorMessage = error.message || 'Erro desconhecido. Tente novamente.';
                    }
                    
                    // Mostrar erro no campo específico
                    if (errorField === 'email') {
                        document.getElementById('email-error').textContent = errorMessage;
                        document.getElementById('email-error').classList.add('show');
                        goToStep(1);
                    } else if (errorField === 'password') {
                        document.getElementById('password-error').textContent = errorMessage;
                        document.getElementById('password-error').classList.add('show');
                        goToStep(1);
                    }
                    
                    showToast(errorMessage, 'error');
                    console.error('Erro no cadastro:', error);
                }
            });
        });

        // Função para mostrar toast
        function showToast(message, type = 'info') {
            // Remover toasts antigos
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${message}
                <button class="toast-close">
                    <span class="material-icons">close</span>
                </button>
            `;
            
            document.body.appendChild(toast);
            
            // Animar entrada
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateY(0)';
            }, 10);
            
            // Remover toast após 5 segundos
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 5000);
            
            // Fechar ao clicar no botão
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            });
        }
    </script>
    <style>
        .register-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            animation: fadeIn 0.5s ease;
        }

        .register-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 500px;
            padding: 32px;
            animation: slideIn 0.5s ease;
        }

        .register-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .register-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .register-subtitle {
            color: var(--text-light);
            text-align: center;
            margin-bottom: 24px;
        }

        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            background-color: white;
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .register-button {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .register-button:hover {
            background-color: var(--primary-dark);
        }

        .register-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .login-link {
            text-align: center;
            margin-top: 24px;
            color: var(--text-light);
        }

        .login-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .password-input {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 4px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-top: 20px;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
        }

        .checkbox-group input[type="checkbox"] {
            margin-top: 3px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 14px;
            color: var(--text-color);
            cursor: pointer;
            line-height: 1.4;
        }

        .checkbox-group a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .checkbox-group a:hover {
            text-decoration: underline;
        }

        .user-type {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .user-type-option {
            flex: 1;
            padding: 16px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            background-color: white;
        }

        .user-type-option:hover {
            border-color: var(--primary-light);
            background-color: #f8fafc;
        }

        .user-type-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-bg);
            box-shadow: 0 0 0 1px var(--primary-color);
        }

        .user-type-icon {
            font-size: 32px;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 32px;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #eee;
            z-index: 1;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .step-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #eee;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            margin-bottom: 8px;
            transition: var(--transition);
            border: 2px solid white;
        }

        .step-circle.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-color);
        }

        .step-label {
            font-size: 12px;
            color: var(--text-light);
            text-align: center;
        }

        .step-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .step-content.active {
            display: block;
        }

        .buttons-container {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .back-button {
            flex: 1;
            padding: 14px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .back-button:hover {
            background-color: #5a6268;
        }

        .back-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .next-button {
            flex: 2;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .next-button:hover {
            background-color: var(--primary-dark);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 100px;
            font-family: 'Roboto', sans-serif;
        }

        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .user-type {
                flex-direction: column;
            }
            
            .register-card {
                padding: 24px;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .back-button, .next-button, .register-button {
                width: 100%;
            }
        }
    </style>
</body>
</html>