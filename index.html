<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click Serviços</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Header Navigation -->
    <div class="nav-header">
        <a href="index.html" class="nav-logo">
            <span class="material-icons">handyman</span>
            Click Serviços
        </a>
        <div class="nav-links">
            <button class="icon-button" id="profile-button">
                <span class="material-icons">account_circle</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-screen" class="container">
        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" id="search-input" class="search-input" placeholder="Buscar serviços...">
            <span class="material-icons search-icon">search</span>
        </div>
        
        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <button class="filter-button" id="sort-button">
                <span class="material-icons">sort</span>
                Ordenar
            </button>
            <button class="filter-button" id="filter-button">
                <span class="material-icons">filter_list</span>
                Filtrar
            </button>
        </div>
        
        <!-- Services List -->
        <div class="services-list" id="services-list">
            <!-- Os serviços serão carregados aqui -->
            <div class="loading-state">
                <span class="material-icons loading">refresh</span>
                <p>Carregando serviços...</p>
            </div>
        </div>
    </div>

    <!-- Provider Profile Screen -->
    <div id="provider-profile-screen" class="hidden">
        <div class="container">
            <button class="icon-button" id="back-from-provider">
                <span class="material-icons">arrow_back</span>
            </button>
            
            <div class="profile-header">
                <div class="profile-avatar">
                    <span class="material-icons">person</span>
                </div>
                <h2 class="profile-name" id="provider-name">Nome do Prestador</h2>
                <div class="profile-category" id="provider-category">Categoria</div>
            </div>
            
            <div class="info-card">
                <div class="info-card-content">
                    <div class="stats-container">
                        <div class="stat-item">
                            <div class="stat-value" id="provider-rating">4.5</div>
                            <div class="stat-label">Avaliação</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="provider-distance">2.5 km</div>
                            <div class="stat-label">Distância</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="provider-price">Contato</div>
                            <div class="stat-label">Contato</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">Sobre</div>
                <div class="info-card-content">
                    <p id="provider-description">Descrição do serviço...</p>
                </div>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">Contato</div>
                <div class="info-card-content">
                    <div class="contact-buttons">
                        <button class="contact-button phone-button" id="phone-button">
                            <span class="material-icons">call</span>
                            Ligar
                        </button>
                        <button class="contact-button whatsapp-button" id="whatsapp-button">
                            <span class="material-icons">chat</span>
                            WhatsApp
                        </button>
                    </div>
                    <button class="contact-button email-button" id="email-button">
                        <span class="material-icons">email</span>
                        E-mail
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Screen -->
    <div id="user-profile-screen" class="hidden">
        <div class="container">
            <button class="icon-button" id="back-from-user">
                <span class="material-icons">arrow_back</span>
            </button>
            
            <div class="profile-header">
                <div class="profile-avatar">
                    <span class="material-icons">account_circle</span>
                </div>
                <h2 class="profile-name" id="user-name">Usuário</h2>
                <p id="user-email">usuario@email.com</p>
            </div>
            
            <div class="info-card">
                <div class="info-card-header">Informações</div>
                <div class="info-card-content">
                    <div class="info-row">
                        <span class="material-icons info-icon">phone</span>
                        <div class="info-content">
                            <span class="info-title">Telefone</span>
                            <span class="info-value" id="user-phone">Não informado</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="material-icons info-icon">email</span>
                        <div class="info-content">
                            <span class="info-title">E-mail</span>
                            <span class="info-value" id="user-email-value">usuario@email.com</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <span class="material-icons info-icon">location_on</span>
                        <div class="info-content">
                            <span class="info-title">Localização</span>
                            <span class="info-value" id="user-location">São Paulo, SP</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-card">
                <div class="info-card-content">
                    <div class="settings-item" id="edit-profile">
                        <div class="settings-left">
                            <span class="material-icons">edit</span>
                            <span>Editar Perfil</span>
                        </div>
                        <span class="material-icons">chevron_right</span>
                    </div>
                    <div class="settings-item">
                        <div class="settings-left">
                            <span class="material-icons">notifications</span>
                            <span>Notificações</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div class="settings-left">
                            <span class="material-icons">security</span>
                            <span>Privacidade</span>
                        </div>
                        <span class="material-icons">chevron_right</span>
                    </div>
                </div>
            </div>
            
            <button class="logout-button" id="logout-button">
                Sair da Conta
            </button>
        </div>
    </div>

    <!-- Sort Modal -->
    <div id="sort-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Ordenar por</h2>
                <button class="modal-close" id="close-sort-modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-content">
                <div class="modal-option" data-sort="rating">
                    <span class="material-icons">star</span>
                    <span>Melhor Avaliação</span>
                </div>
                <div class="modal-option" data-sort="distance">
                    <span class="material-icons">location_on</span>
                    <span>Mais Próximo</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filter-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Filtrar por Categoria</h2>
                <button class="modal-close" id="close-filter-modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-content">
                <div class="category-filter-list" id="category-filter-list">
                    <!-- Categorias serão carregadas dinamicamente -->
                </div>
            </div>
            <div class="modal-content" style="display: flex; justify-content: flex-end; padding-top: 0;">
                <button class="contact-button" style="background-color: var(--primary-color);" id="close-filter-button">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Editar Perfil</h2>
                <button class="modal-close" id="close-edit-modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-name" class="form-label">Nome</label>
                    <input type="text" id="edit-name" class="form-input" placeholder="Seu nome">
                </div>
                <div class="form-group">
                    <label for="edit-email" class="form-label">E-mail</label>
                    <input type="email" id="edit-email" class="form-input" placeholder="seu@email.com">
                </div>
                <div class="form-group">
                    <label for="edit-phone" class="form-label">Telefone</label>
                    <input type="tel" id="edit-phone" class="form-input" placeholder="(11) 99999-9999">
                </div>
            </div>
            <div class="modal-content" style="display: flex; justify-content: flex-end; gap: 8px; padding-top: 0;">
                <button class="contact-button" style="background-color: #6c757d;" id="cancel-edit">
                    Cancelar
                </button>
                <button class="contact-button" style="background-color: var(--primary-color);" id="save-profile">
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Logout Modal -->
    <div id="logout-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Sair da Conta</h2>
                <button class="modal-close" id="close-logout-modal">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-content">
                <p>Tem certeza que deseja sair da sua conta?</p>
            </div>
            <div class="modal-content" style="display: flex; justify-content: flex-end; gap: 8px; padding-top: 0;">
                <button class="contact-button" style="background-color: #6c757d;" id="cancel-logout">
                    Cancelar
                </button>
                <button class="contact-button" style="background-color: #f44336;" id="confirm-logout">
                    Sair
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Click Serviços</h3>
                <p>Conectando você aos melhores prestadores de serviço da região.</p>
            </div>
            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <ul class="footer-links">
                    <li><a href="index.html">Início</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="register.html">Cadastro</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contato</h3>
                <ul class="footer-links">
                    <li><a href="mailto:suporte@clickservicos.com">suporte@clickservicos.com</a></li>
                    <li><a href="tel:+5511999999999">(11) 99999-9999</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Click Serviços. Todos os direitos reservados.</p>
            <p style="font-size: 12px; margin-top: 8px;">Hospedado no GitHub Pages</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="firebase-config.js"></script>
    <script src="config.js"></script>
    <script src="navigation.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Navegação personalizada para index.html
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Index.html DOM carregado');
            
            // Adicionar estado de carregamento
            const servicesList = document.getElementById('services-list');
            if (servicesList) {
                servicesList.innerHTML = `
                    <div class="loading-state">
                        <span class="material-icons loading">refresh</span>
                        <p>Carregando serviços...</p>
                    </div>
                `;
            }
            
            const profileButton = document.getElementById('profile-button');
            
            if (!profileButton) {
                console.log('Botão de perfil não encontrado');
                return;
            }
            
            // Configurar categorias no filtro
            const categoryFilterList = document.getElementById('category-filter-list');
            if (categoryFilterList && window.CONFIG && window.CONFIG.CATEGORIES) {
                window.CONFIG.CATEGORIES.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'modal-option category-item';
                    categoryItem.dataset.category = category;
                    categoryItem.innerHTML = `
                        <span class="material-icons">category</span>
                        <span>${category}</span>
                        <span class="material-icons check-icon" style="margin-left: auto; display: none;">check</span>
                    `;
                    categoryFilterList.appendChild(categoryItem);
                    
                    categoryItem.addEventListener('click', function() {
                        this.classList.toggle('selected');
                        const checkIcon = this.querySelector('.check-icon');
                        checkIcon.style.display = this.classList.contains('selected') ? 'block' : 'none';
                    });
                });
            }
            
            // Função para mostrar apenas uma tela por vez
            function mostrarTela(telaId) {
                // Lista de todas as telas principais
                const telas = ['main-screen', 'provider-profile-screen', 'user-profile-screen'];
                
                // Esconder todas as telas
                telas.forEach(id => {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.classList.add('hidden');
                    }
                });
                
                // Mostrar apenas a tela desejada
                const telaParaMostrar = document.getElementById(telaId);
                if (telaParaMostrar) {
                    telaParaMostrar.classList.remove('hidden');
                }
            }
            
            // Verificar se está logado
            if (typeof navigation !== 'undefined') {
                const loggedIn = await navigation.isLoggedIn();
                
                if (loggedIn) {
                    console.log('Usuário logado, configurando perfil...');
                    
                    // Usuário logado - mostrar perfil
                    profileButton.addEventListener('click', async function() {
                        const userData = await navigation.getUserData();
                        
                        // Atualizar informações do perfil
                        const userName = document.getElementById('user-name');
                        const userEmail = document.getElementById('user-email');
                        const userPhone = document.getElementById('user-phone');
                        const userEmailValue = document.getElementById('user-email-value');
                        const userLocation = document.getElementById('user-location');
                        
                        if (userName) userName.textContent = userData.nome;
                        if (userEmail) userEmail.textContent = userData.email;
                        if (userPhone) userPhone.textContent = userData.telefone || 'Não informado';
                        if (userEmailValue) userEmailValue.textContent = userData.email;
                        if (userLocation) userLocation.textContent = userData.localizacao || window.CONFIG?.DEFAULT_LOCATION || 'São Paulo, SP';
                        
                        // Mostrar tela de perfil do usuário usando a função mostrarTela
                        mostrarTela('user-profile-screen');
                    });
                    
                    // Configurar botão de logout
                    const confirmLogoutBtn = document.getElementById('confirm-logout');
                    if (confirmLogoutBtn) {
                        confirmLogoutBtn.addEventListener('click', function() {
                            if (navigation && navigation.logout) {
                                navigation.logout();
                            }
                        });
                    }
                    
                    // Configurar botão de edição de perfil
                    const editProfileBtn = document.getElementById('edit-profile');
                    if (editProfileBtn) {
                        editProfileBtn.addEventListener('click', async function() {
                            const userData = await navigation.getUserData();
                            
                            const editName = document.getElementById('edit-name');
                            const editEmail = document.getElementById('edit-email');
                            const editPhone = document.getElementById('edit-phone');
                            
                            if (editName) editName.value = userData.nome;
                            if (editEmail) editEmail.value = userData.email;
                            if (editPhone) editPhone.value = userData.telefone || '';
                            
                            const editProfileModal = document.getElementById('edit-profile-modal');
                            if (editProfileModal) editProfileModal.classList.remove('hidden');
                        });
                    }
                    
                    // Salvar perfil editado
                    const saveProfileBtn = document.getElementById('save-profile');
                    if (saveProfileBtn) {
                        saveProfileBtn.addEventListener('click', async function() {
                            const editName = document.getElementById('edit-name');
                            const editEmail = document.getElementById('edit-email');
                            const editPhone = document.getElementById('edit-phone');
                            
                            if (!editName || !editEmail) {
                                showToast('Erro: Campos não encontrados', 'error');
                                return;
                            }
                            
                            const updatedData = {
                                nome: editName.value,
                                email: editEmail.value,
                                telefone: editPhone ? editPhone.value : ''
                            };
                            
                            try {
                                const userData = await navigation.getUserData();
                                const fullData = { ...userData, ...updatedData };
                                
                                await navigation.updateUserData(fullData);
                                
                                // Atualizar exibição
                                const userName = document.getElementById('user-name');
                                const userEmail = document.getElementById('user-email');
                                const userPhone = document.getElementById('user-phone');
                                const userEmailValue = document.getElementById('user-email-value');
                                
                                if (userName) userName.textContent = fullData.nome;
                                if (userEmail) userEmail.textContent = fullData.email;
                                if (userPhone) userPhone.textContent = fullData.telefone;
                                if (userEmailValue) userEmailValue.textContent = fullData.email;
                                
                                showToast('Perfil atualizado com sucesso!', 'success');
                                
                                const editProfileModal = document.getElementById('edit-profile-modal');
                                if (editProfileModal) editProfileModal.classList.add('hidden');
                            } catch (error) {
                                showToast('Erro ao atualizar perfil: ' + error.message, 'error');
                            }
                        });
                    }
                    
                    // Configurar modais
                    const closeEditModal = document.getElementById('close-edit-modal');
                    const cancelEdit = document.getElementById('cancel-edit');
                    if (closeEditModal) {
                        closeEditModal.addEventListener('click', function() {
                            const editProfileModal = document.getElementById('edit-profile-modal');
                            if (editProfileModal) editProfileModal.classList.add('hidden');
                        });
                    }
                    if (cancelEdit) {
                        cancelEdit.addEventListener('click', function() {
                            const editProfileModal = document.getElementById('edit-profile-modal');
                            if (editProfileModal) editProfileModal.classList.add('hidden');
                        });
                    }
                    
                    const closeLogoutModal = document.getElementById('close-logout-modal');
                    const cancelLogout = document.getElementById('cancel-logout');
                    if (closeLogoutModal) {
                        closeLogoutModal.addEventListener('click', function() {
                            const logoutModal = document.getElementById('logout-modal');
                            if (logoutModal) logoutModal.classList.add('hidden');
                        });
                    }
                    if (cancelLogout) {
                        cancelLogout.addEventListener('click', function() {
                            const logoutModal = document.getElementById('logout-modal');
                            if (logoutModal) logoutModal.classList.add('hidden');
                        });
                    }
                    
                    const logoutButton = document.getElementById('logout-button');
                    if (logoutButton) {
                        logoutButton.addEventListener('click', function() {
                            const logoutModal = document.getElementById('logout-modal');
                            if (logoutModal) logoutModal.classList.remove('hidden');
                        });
                    }
                    
                    // Configurar voltar dos perfis usando a função mostrarTela
                    const backFromProvider = document.getElementById('back-from-provider');
                    const backFromUser = document.getElementById('back-from-user');
                    
                    if (backFromProvider) {
                        backFromProvider.addEventListener('click', function() {
                            mostrarTela('main-screen');
                        });
                    }
                    
                    if (backFromUser) {
                        backFromUser.addEventListener('click', function() {
                            mostrarTela('main-screen');
                        });
                    }
                    
                } else {
                    // Usuário não logado - redirecionar para login
                    console.log('Usuário não logado, configurando redirecionamento para login');
                    profileButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.location.href = 'login.html';
                    });
                }
            } else {
                console.log('Navigation não disponível');
            }
            
            // Configurar modais comuns
            const sortButton = document.getElementById('sort-button');
            const filterButton = document.getElementById('filter-button');
            const closeSortModal = document.getElementById('close-sort-modal');
            const closeFilterModal = document.getElementById('close-filter-modal');
            const closeFilterButton = document.getElementById('close-filter-button');
            
            if (sortButton) {
                sortButton.addEventListener('click', function() {
                    const sortModal = document.getElementById('sort-modal');
                    if (sortModal) sortModal.classList.remove('hidden');
                });
            }
            
            if (filterButton) {
                filterButton.addEventListener('click', function() {
                    const filterModal = document.getElementById('filter-modal');
                    if (filterModal) filterModal.classList.remove('hidden');
                });
            }
            
            if (closeSortModal) {
                closeSortModal.addEventListener('click', function() {
                    const sortModal = document.getElementById('sort-modal');
                    if (sortModal) sortModal.classList.add('hidden');
                });
            }
            if (closeFilterModal) {
                closeFilterModal.addEventListener('click', function() {
                    const filterModal = document.getElementById('filter-modal');
                    if (filterModal) filterModal.classList.add('hidden');
                });
            }
            if (closeFilterButton) {
                closeFilterButton.addEventListener('click', function() {
                    const filterModal = document.getElementById('filter-modal');
                    if (filterModal) filterModal.classList.add('hidden');
                });
            }
            
            // Opções de ordenação
            document.querySelectorAll('.modal-option[data-sort]').forEach(option => {
                option.addEventListener('click', function() {
                    const sortValue = this.getAttribute('data-sort');
                    if (window.filtrarServicos && typeof window.filtrarServicos === 'function') {
                        window.filtrarServicos(sortValue);
                    }
                    const sortModal = document.getElementById('sort-modal');
                    if (sortModal) sortModal.classList.add('hidden');
                });
            });
            
            // Fechar modais clicando fora
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
        });

        // Função para mostrar toast
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${message}
                <button class="toast-close">
                    <span class="material-icons">close</span>
                </button>
            `;
            
            document.body.appendChild(toast);
            
            // Animar entrada
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateY(0)';
            }, 10);
            
            // Remover toast após 5 segundos
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 5000);
            
            // Fechar ao clicar no botão
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            });
        }
    </script>
    
    <style>
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-light);
        }
        
        .loading-state .material-icons {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--primary-color);
        }
        
        .category-item.selected {
            background-color: var(--primary-bg);
        }
        
        .category-item.selected .check-icon {
            color: var(--primary-color);
        }
        
        .category-item:hover {
            background-color: #f5f5f5;
        }
    </style>
</body>
</html>